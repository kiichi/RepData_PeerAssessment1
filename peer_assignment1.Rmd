---
title: "Peer Assignment 1 - Reproducible Research"
author: "Kiichi Takeuchi"
date: "July 16, 2014"
output: html_document
---

##Setup
First, setup your work directory path.

```{r pathsetup,echo=TRUE}
setwd("~/work/r/class/RepData_PeerAssessment1")
```

Extract Zip file if it was not extracted yet
```{r unzipping,echo=TRUE}
if (!file.exists("activity.csv")){
  unzip("activity.zip")
}
```

##Loading Data
Next, load the data file
```{r loading,echo=TRUE,results='hide'}
library(data.table)
data<-fread("activity.csv")
```

##Calculate Steps per Day and Histogram
```{r sum_per_day,echo=TRUE}
library(ggplot2)
sum_by_date <- data[,list(total=sum(steps,na.rm=T)),by=date]
```

Draw histogram of Steps per Day
```{r histgram_sum,echo=TRUE,fig.width=15,fig.height=7}
ggplot(sum_by_date, aes(x=date, y=total)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90,hjust = 1))# + coord_flip()# + scale_x_reverse() 
```

##Mean and Median
```{r mean_median,echo=TRUE}
mean(sum_by_date$total)
median(sum_by_date$total)
```

##The average daily activity pattern
Time Series Plot would be generated as below. The 5-minute interval and the average number of steps taken, averaged across all days.

```{r interval, echo=TRUE,fig.height=4}
avg_interval <- data[,list(avg=mean(steps,na.rm=T)),by=interval]
ggplot(data=avg_interval,aes(x=interval,y=avg)) + geom_line()
```

The max average steps and which interval is it?
```{r max_interval,echo=TRUE}
avg_interval[avg==max(avg_interval$avg),]
```


Total Number of NA (Missing Values)
```{r missing_na, echo=TRUE}
sum(is.na(data$steps))
```

##Imputing missing values
Here is the approach that I took to fill those missing values. I've used average value of each interval in order to replace NA in steps column. Before filling data, I merged original data table with average table by interval as the key. Make sure order by date and interval after the process.
```{r filling_na1, echo=TRUE}
data_avg<-merge(data,avg_interval,by="interval")[order(date,interval)]
```
After mergining tables, fill steps where it contains NA. I'm casting average steps as integer below. The second line is verification code. The number of NA should be zero.
```{r filling_na2, echo=TRUE}
data_f<-data # copy data first
data_f[is.na(data_f$steps),c('steps')]<-as.integer(data_avg[is.na(data_f$steps),avg])
sum(is.na(data$steps))
```



